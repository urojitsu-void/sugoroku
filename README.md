# VTuber配信用すごろく

VTuber 配信企画向けに作成した、クリックでダイスを振って進行するすごろくゲームです。Vite + React + TypeScript で実装し、マス定義は Zod でバリデーション、Jest でデータテストを行っています。GitHub Pages へそのまま公開できるように `base: './'` 設定と `deploy` スクリプトを用意しました。

## 主な特徴

- 画面全体のクリックで 6 面ダイスをロール（右下のパネルを除く UI でも操作可能）。
- 最大 4 人までのプレイヤー数を起動時に選択、色分けされたトークンでボード上に表示。
- 「進む / 戻る / 1 回休み」のギミックと、左右キーで選択・クリックで決定する分岐マスを実装。
- マスは `title` と `description` を持ち、配信ネタ（恥ずかしいエピソードなど）をそのまま表示。
- マスの接続情報からコネクションラインを描画し、現在位置や分岐の選択が視覚的にわかる UI。
- ボードデータは Zod で厳密に型検証し、Jest でゴール到達性やギミックの妥当性をテスト。

## 操作方法

1. 起動後に表示されるオーバーレイでプレイヤー人数（1〜4 人）を選択します。
2. 画面をクリックすると現在プレイヤーがダイスを振り、出目ぶんだけ自動で進みます。
3. 分岐マスに入ると ← → キーでルートを選択し、決定はクリックで行います。
4. 休みマスや戻るマスの効果は自動適用され、プレイヤーボードに状態が表示されます。
5. 先にゴールへ到着したプレイヤーが勝利です。`リセット` ボタンでゲームをやり直せます。

## 開発コマンド

```bash
pnpm install           # 依存関係のインストール
pnpm dev               # 開発サーバー
pnpm build             # 本番ビルド（dist/ に出力）
pnpm test              # Zod/Jest を用いたボードデータテスト
pnpm deploy            # dist/ を gh-pages ブランチにデプロイ
```

> `pnpm deploy` は内部で `pnpm build` を実行し、`gh-pages` パッケージで `dist/` を GitHub Pages へ公開します。Git リポジトリにリモートが設定されている必要があります。

## GitHub Pages への公開

1. `pnpm build` を実行して `dist/` を生成します。
2. 生成物を `gh-pages` ブランチへ配置する場合は `pnpm deploy` を利用してください。
3. リポジトリの Settings → Pages で `gh-pages` ブランチを指定すると公開できます。`vite.config.ts` の `base: './'` 設定によりサブディレクトリ配信にも対応しています。

## テストについて

- `src/data/board.ts` でボード構造を Zod スキーマでバリデーションし、重複 ID や未定義の参照を防止しています。
- `src/data/board.test.ts` は Jest で以下を検証します:
  - スキーマを満たしているか
  - スタートからゴールまで到達できるか
  - 進む/戻るギミックが実際に移動可能なマス数を持っているか

これにより、配信用にマス情報を編集しても安全にデータを確認できます。
